# Blackwell architecture GPU configuration for Chatterbox TTS API
# This file extends docker-compose.yml and optimizes for NVIDIA Blackwell GPUs
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.blackwell.yml up
#
# Or use the simplified command:
#   cd docker && docker compose -f docker-compose.blackwell.yml up

services:
  chatterbox-tts:
    build:
      dockerfile: docker/Dockerfile
      args:
        BASE_IMAGE: nvidia/cuda:12.8.1-runtime-ubuntu22.04
        PYTORCH_VERSION: 2.7.0
        TORCHVISION_VERSION: 0.22.0
        TORCHAUDIO_VERSION: 2.7.0
        PYTORCH_INDEX: https://download.pytorch.org/whl/cu128
        DEVICE: cuda
        NEEDS_PYTHON_INSTALL: "true"
        EXTRA_PACKAGES: setuptools
    container_name: chatterbox-tts-api-blackwell
    environment:
      DEVICE: cuda
      TTS_MODEL_TYPE: ${TTS_MODEL_TYPE:-multilingual}
      NVIDIA_VISIBLE_DEVICES: all
      NVIDIA_DRIVER_CAPABILITIES: compute,utility
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
